# Reporting System Documentation

## Overview

This document outlines the comprehensive reporting system implemented for the Islamic app, allowing users to report issues with AI chatbot responses, AI verse explanations, and hadith content. The system provides a robust mechanism for content quality control and user feedback.

## Features

### 1. **Multi-Type Reporting**
- **AI Chatbot Messages**: Report inappropriate or incorrect responses from the AI assistant
- **AI Explanations**: Report issues with verse explanations generated by AI
- **Hadith Content**: Report accuracy or authenticity concerns with hadith content

### 2. **Categorized Reports**
Each report type supports relevant categories:

**AI Chatbot & AI Explanations:**
- Incorrect Information
- Inappropriate Content  
- Misleading Guidance
- Technical Error
- Other

**Hadith Content:**
- Incorrect Information
- Inconsistency
- Inappropriate Content
- Technical Error
- Other

### 3. **User-Friendly Interface**
- Modal dialog with intuitive category selection
- Content preview showing what's being reported
- Optional detailed description field
- Real-time validation and feedback

### 4. **Report Tracking**
- Users can view their submitted reports
- Status tracking (Pending, Reviewing, Resolved, Dismissed)
- Admin response notifications
- Historical report archive

## Database Schema

### Reports Table
```sql
CREATE TABLE reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id),
  report_type report_type NOT NULL,
  category report_category NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  content_id TEXT,
  content_data JSONB,
  context_data JSONB,
  status report_status DEFAULT 'pending',
  admin_notes TEXT,
  resolved_at TIMESTAMP WITH TIME ZONE,
  resolved_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Enums
- `report_type`: 'ai_chatbot', 'ai_explanation', 'hadith'
- `report_category`: 'incorrect_information', 'inappropriate_content', 'misleading_guidance', 'technical_error', 'inconsistency', 'offensive_content', 'other'
- `report_status`: 'pending', 'reviewing', 'resolved', 'dismissed'

## Implementation Structure

### Core Components

#### 1. **ReportService** (`lib/core/services/report_service.dart`)
- Singleton service managing all report operations
- Supabase integration for data persistence
- Rate limiting (5 reports per hour per user)
- Type-specific helper methods

#### 2. **ReportDialog** (`lib/core/widgets/dialog/report_dialog.dart`)
- Reusable dialog component for all report types
- Static factory methods for different report types
- Form validation and submission handling
- User-friendly error messaging

#### 3. **UserReportsScreen** (`lib/features/settings/presentation/pages/user_reports_screen.dart`)
- Dedicated screen for viewing user's reports
- Status tracking and filtering
- Admin response display
- Pull-to-refresh functionality

### Integration Points

#### 1. **AI Chatbot Screen**
- Report button on each bot message (except welcome message)
- Context includes message content, timestamp, references
- Login requirement check

#### 2. **Verse View Screen**
- Report button in AI explanation section
- Context includes surah/verse information
- Integrated with memorization features

#### 3. **Hadith Detail Screen**
- Report button in bottom action bar
- Comprehensive hadith metadata capture
- Book and chapter context preservation

## Security & Privacy

### Row Level Security (RLS)
- Users can only create and view their own reports
- Admin users have full access with proper role checking
- Automatic user association on report creation

### Data Protection
- Sensitive content stored in JSONB fields
- Context data for debugging and resolution
- No personal information in report content

### Rate Limiting
- Maximum 5 reports per hour per user
- Prevents spam and abuse
- Configurable limits in service layer

## User Experience

### Report Submission Flow
1. User clicks report button on content
2. Login check (required for reporting)
3. Report dialog opens with content preview
4. User selects category and provides details
5. Form validation and submission
6. Success/error feedback
7. Optional navigation to reports view

### Report Tracking
1. Navigate to "My Reports" in settings
2. View all submitted reports with status
3. See admin responses when available
4. Filter by type, status, or date
5. Pull to refresh for updates

## Admin Features

### Report Management
- View all reports with filtering capabilities
- Update report status and add admin notes
- Mark reports as resolved with resolution notes
- Bulk actions for similar reports

### Analytics & Insights
- Report volume and trends
- Common categories and issues
- User feedback patterns
- Content quality metrics

## Technical Considerations

### Performance
- Efficient database queries with proper indexing
- Pagination for large report lists
- Optimistic UI updates where possible
- Cached user permissions

### Scalability
- JSONB storage for flexible content structures
- Partitioning strategies for large datasets
- Background processing for heavy operations
- CDN for static assets

### Monitoring
- Report submission success/failure rates
- Response time monitoring
- Error tracking and alerting
- User engagement metrics

## Future Enhancements

### Planned Features
1. **Automated Content Analysis**
   - AI-powered initial screening
   - Duplicate detection
   - Priority scoring

2. **Enhanced User Feedback**
   - Email notifications for status updates
   - In-app notification system
   - Feedback on resolution quality

3. **Advanced Analytics**
   - Content quality dashboards
   - Trend analysis and reporting
   - User satisfaction metrics

4. **Mobile Optimizations**
   - Offline report queuing
   - Background sync
   - Enhanced accessibility

### API Extensions
- Public API for report analytics
- Webhook support for external integrations
- Bulk import/export capabilities

## Getting Started

### For Developers

1. **Database Setup**
   ```bash
   # Apply the migration
   supabase db reset
   ```

2. **Service Registration**
   ```dart
   // Already registered in app_injections.dart
   getIt.registerLazySingleton<ReportService>(() {
     final reportService = ReportService.instance;
     reportService.initialize();
     return reportService;
   });
   ```

3. **Usage Example**
   ```dart
   // Show AI explanation report dialog
   ReportDialog.showAIExplanationReport(
     context,
     explanation: explanationText,
     surahNumber: 1,
     verseNumber: 1,
   );
   ```

### For Administrators

1. **Access Reports Dashboard**
   - Login with admin credentials
   - Navigate to admin panel
   - Filter and manage reports

2. **Respond to Reports**
   - Update status appropriately
   - Add helpful admin notes
   - Mark as resolved when complete

This reporting system provides a robust foundation for maintaining content quality and addressing user concerns effectively while ensuring a smooth user experience. 